

![JDShopCar.jpg](http://upload-images.jianshu.io/upload_images/3265262-e5a8fc508f69204b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#  购物车的实现
## 数据抓包
### 熟练使用charles,[推荐唐巧大神的这篇文章](http://blog.devtang.com/2015/11/14/charles-introduction/#Charles__u9650_u65F6_u4F18_u60E0)
### 熟练使用postman,[这里是下载地址](https://www.getpostman.com/apps)
### 在熟悉以上的两个软件后,开始抓包
1. 用charles开启代理本机,开机真机代理,由于可能会有https,要相应的允许ssl并下载证书.在iphone的浏览器打开charles提示的网址,安装提示的文件,这样charles可以同事抓到电脑和iphone的数据包
2. 开始模拟http请求,对比模拟的请求头和抓到jdapp的数据的请求头和body,先利用postman模拟实现,然后开始代码实现
3. postman的请求实现后,代码模拟,这一步最重要,因为涉及到编码的问题,在charles里面可以看到自己发送的请求,然后和jdapp的请求作对比

adid=87BCDF77-D843-46E9-B7E5-83F18FA67806&area=12_904_905_50599&body=%7B%22specialId%22%3A%221%22%2C%22noResponse%22%3Afalse%2C%22cartuuid%22%3A%22coW0lj7vbXVin6h7ON%2BtMNFQqYBqMahr%22%2C%22carttype%22%3A%221%22%2C%22syntype%22%3A%221%22%2C%22adid%22%3A%2287BCDF77-D843-46E9-B7E5-83F18FA67806%22%2C%22openudid%22%3A%2274d33ae25b8353446044bf7100a174275196c178%22%7D&build=163840&client=apple&clientVersion=6.6.0&d_brand=apple&d_model=iPhone9%2C2&isBackground=N&lang=zh_CN&networkType=wifi&networklibtype=JDNetworkBaseAF&openudid=74d33ae25b8353446044bf7100a174275196c178&osVersion=11.1.2&partner=apple&screen=1242%2A2208&sign=6b2b859e96a070c830ec9578821c920a&st=1515245622880&sv=121&uuid=coW0lj7vbXVin6h7ON%2BtMNFQqYBqMahr

4. 提示一点,由于抓到的包是已经编码过,我们需要解码后,再通过Alamofire编码才能不出错

## 页面结构
### 思考页面采用UITableView还是UICollectionView

初看,带有section的header悬停效果,感觉采用UITableView,然后选择.plain模式就可以.往下滑动的时候出现了为你推荐栏目,每一行有两个item,这是典型的UIcollectionViewCell的布局方式.

如果一行有两个item用UITableView也可以写,只需要将一个cell写两个item,相应的数据结构改变一下,但是这种做法感觉怪怪的.

如果用UICollectionView写的话,由于没有自带plain的悬停效果,需要自定义flowout.在网上找了一篇文章[UicollectionView的Header悬停效果](https://github.com/HebeTienCoder/XLPlainFlowLayout)

### 页面三部分结构

1. 购物车的商品信息

2. 为你推荐

3. 底部"去结算"

## 功能实现


抓取的数据包
{"imageDomain":"https://m.360buyimg.com/mobilecms/s450x450_","resultCode":0,"code":"0","cartInfo":{"vendors":[{"vendorId":111060,"vendorType":0,"shopId":108735,"shopName":"志远3C配件专营店","hasCoupon":1,"vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":9,"item":{"items":[{"itemType":1,"item":{"Tags":[],"Discount":0.0,"IdForOldVersion":18727331198,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"65536","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[{"id":6846871775,"title":"满30.00减10.00","type":10,"checkType":1}],"propertyTags":{"a":"颜色:粉色 iphonex"},"cid":866,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条3期免息"}]},"cardSpecialId":4,"isProvideService":0,"beanScore":"赠20京豆","overseaPurchase":0,"canSelectPrices":[],"Id":"18727331198","Name":"【下单减10元 京东配送】苹果x挂绳硅胶壳可爱朱迪兔全包防摔 iphonex手机壳卡通 粉色 iphonex","Num":1,"Price":68.0,"PriceShow":"￥68.00","ImgUrl":"jfs/t15961/296/875431072/594958/5dae4786/5a41eda6N442610cc.jpg!q70.jpg","CheckType":0}}],"NeedMoney":30.0,"Num":1,"Skus":[],"Gifts":[],"RePrice":0.0,"Price":68.0,"Discount":0.0,"Id":6846871775,"PriceShow":"￥0.00","Point":0,"STip":"购满30元，可减10元","SType":11,"CheckType":0,"CanSelectGifts":[],"suitType":10,"promotionId":"6846871775","specialId":"0","isReachCondition":true,"suitLabel":"满减","entryLabel":"去凑单","stillNeed":"0"}}]},{"vendorId":638874,"vendorType":0,"shopId":634424,"shopName":"贝拉记旗舰店","hasCoupon":1,"vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":9,"item":{"items":[{"itemType":1,"item":{"Tags":[],"Discount":0.0,"IdForOldVersion":17020961280,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"65536","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[{"id":5692324975,"title":"满3件，价格最低1件免费","type":10,"checkType":1}],"propertyTags":{"a":"颜色:苹果X-荼蘼"},"cid":866,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条3期免息"}]},"cardSpecialId":4,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"17020961280","Name":"贝拉记 苹果X手机壳挂绳女3D浮雕保护套iPhoneX/10手机硅胶磨砂套适用苹果X 苹果X-荼蘼","Num":1,"Price":88.0,"PriceShow":"￥88.00","ImgUrl":"jfs/t10897/22/144856331/514753/2ca3e95d/59c706e0Nf678b63d.jpg!q70.jpg","CheckType":0}}],"NeedMoney":0.0,"Num":1,"Skus":[],"Gifts":[],"RePrice":0.0,"Price":88.0,"Discount":0.0,"Id":5692324975,"PriceShow":"￥0.00","Point":0,"STip":"购满3件，即享优惠","SType":11,"CheckType":0,"CanSelectGifts":[],"suitType":10,"promotionId":"5692324975","specialId":"0","isReachCondition":false,"suitLabel":"满减","entryLabel":"去凑单","stillNeed":"0"}}]},{"vendorId":77308,"vendorType":0,"shopId":73805,"shopName":"海戈旗舰店","vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":9,"item":{"items":[{"itemType":1,"item":{"Tags":[],"Discount":0.0,"IdForOldVersion":17980959752,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"65536","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[{"id":6426262588,"title":"满2件总价9.0折，满3件总价8.8折，满4件总价8.5折","type":10,"checkType":1}],"propertyTags":{"a":"颜色:湖蓝孔雀+小结"},"cid":866,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条3期免息"}]},"cardSpecialId":4,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"17980959752","Name":"海戈 苹果x手机壳保护套 iPhonex女款挂绳透明水钻指环硅胶壳 适用于苹果10 湖蓝孔雀+小结","Num":1,"Price":29.98,"PriceShow":"￥29.98","ImgUrl":"jfs/t9709/323/1437483998/345705/b6ac0928/59e07601N715c4666.jpg!q70.jpg","CheckType":0}}],"NeedMoney":0.0,"Num":1,"Skus":[],"Gifts":[],"RePrice":0.0,"Price":29.98,"Discount":0.0,"Id":6426262588,"PriceShow":"￥0.00","Point":0,"STip":"购满2件，总价可打9折","SType":11,"CheckType":0,"CanSelectGifts":[],"suitType":10,"promotionId":"6426262588","specialId":"0","isReachCondition":false,"suitLabel":"满减","entryLabel":"去凑单","stillNeed":"0"}}]},{"vendorId":605241,"vendorType":0,"shopId":597924,"shopName":"南极人慧都专卖店","vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":30.0,"IdForOldVersion":10555123104,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"颜色:纯色隐形船袜"},"cid":12010,"stockCode":0,"maxNum":200,"extFlag":{"dist":"jd"},"cardSpecialId":0,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"10555123104","Name":"南极人【5双装】船袜男士袜子 夏季棉薄款纯色男生浅口短袜防滑隐形秋冬季 65%纯棉 纯色隐形船袜","Num":3,"Price":59.0,"PriceShow":"￥29.00","ImgUrl":"jfs/t2956/278/2443626064/152576/3429def8/57ad6db4N618e084f.jpg!q70.jpg","CheckType":0}}]},{"vendorId":67259,"vendorType":0,"shopId":63630,"shopName":"图拉斯旗舰店","hasCoupon":1,"vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":4.0,"IdForOldVersion":10448270198,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"颜色:灰色-手机挂绳"},"cid":11302,"stockCode":0,"maxNum":200,"cardSpecialId":0,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"10448270198","Name":"图拉斯 手机挂绳 适用于苹果6splus安卓手机挂脖挂绳加长 灰色-手机挂绳","Num":1,"Price":19.8,"PriceShow":"￥15.80","ImgUrl":"jfs/t2932/348/1078724583/27346/1084eee/57736c0fN707fb05a.jpg!q70.jpg","CheckType":0}}]},{"vendorId":673964,"vendorType":0,"shopId":669664,"shopName":"曼森皇族女包旗舰店","hasCoupon":1,"vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":0.0,"IdForOldVersion":12222359397,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"65536","stockState":"有货","remainNum":"仅剩3件","remainNumInt":3,"canSelectPromotions":[],"propertyTags":{"a":"颜色:红色【国际仓储发货】"},"cid":5257,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条3期免息"}]},"cardSpecialId":4,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"12222359397","Name":"MK女包2017秋冬新品包锁扣小方包单肩斜挎包小包包红色金属链条包 红色【国际仓储发货】","Num":1,"Price":520.0,"PriceShow":"￥520.00","ImgUrl":"jfs/t16513/302/485375496/167115/2683d966/5a3486d8N794f5545.jpg!q70.jpg","CheckType":0}}]},{"vendorId":41907,"vendorType":0,"shopId":39401,"shopName":"pzoz数码旗舰店","vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":9,"item":{"items":[{"itemType":1,"item":{"Tags":[],"Discount":19.2,"IdForOldVersion":19030688803,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[{"Tags":[],"Discount":0.0,"IdForOldVersion":15637876749,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":2,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"透明高清【买一送一】"},"cid":867,"stockCode":0,"weight":"重量:0.11kg","maxNum":200,"cardSpecialId":0,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"15637876749","Name":"PZOZ 苹果x钢化膜高清透明钢化防爆玻璃手机贴膜非全屏覆盖抗蓝光iphonex钢化膜 透明高清【买一送一】","Num":1,"Price":0.0,"PriceShow":"￥0.00","ImgUrl":"jfs/t14017/78/567274998/190492/3f1e22cd/5a0e959fN1eab74a8.jpg!q70.jpg","CheckType":0},{"Tags":[],"Discount":0.0,"IdForOldVersion":14638262729,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":2,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"【黑色流苏款】皮质挂绳"},"cid":11302,"stockCode":0,"weight":"重量:0.1kg","maxNum":200,"cardSpecialId":0,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"14638262729","Name":"PZOZ 手机挂绳 通用手机壳功能挂绳 手机挂脖绳挂饰链/旋转挂绳不勒脖VIVO苹果女款 【黑色流苏款】皮质挂绳","Num":1,"Price":0.0,"PriceShow":"￥0.00","ImgUrl":"jfs/t10678/172/1898513322/165441/74c0179c/59e99f2fNa644eb04.jpg!q70.jpg","CheckType":0}],"giftsType":0,"specialId":"65536","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[{"id":5980044743,"title":"满3件，价格最低1件免费","type":10,"checkType":1}],"propertyTags":{"a":"颜色:【小月季★背面为硬壳】送挂绳+钢化膜"},"cid":866,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条3期免息"}]},"cardSpecialId":4,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"19030688803","Name":"PZOZ 苹果x手机壳 水钻全包硅胶软壳个性创意女款挂绳可爱iphonex/10保护套 【小月季★背面为硬壳】送挂绳+钢化膜","Num":1,"Price":49.0,"PriceShow":"￥29.80","ImgUrl":"jfs/t11491/175/747720840/215695/1f860131/59f83278Nf52813dd.jpg!q70.jpg","CheckType":0}}],"NeedMoney":0.0,"Num":1,"Skus":[],"Gifts":[],"RePrice":0.0,"Price":29.8,"Discount":0.0,"Id":5980044743,"PriceShow":"￥0.00","Point":0,"STip":"购满3件，即享优惠","SType":11,"CheckType":0,"CanSelectGifts":[],"suitType":10,"promotionId":"5980044743","specialId":"0","isReachCondition":false,"suitLabel":"满减","entryLabel":"去凑单","stillNeed":"0"}}]},{"vendorId":588625,"vendorType":0,"shopId":580682,"shopName":"蜗牛国际专营店","hasCoupon":1,"vendorPrice":0.0,"freeFreight":99,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":30.1,"IdForOldVersion":1981297429,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"1","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"产品:深层清洁"},"cid":1405,"stockCode":0,"orderType":"1","maxNum":200,"skuLabels":{"skuHead":[{"u":"tab_031"}]},"cardSpecialId":0,"isProvideService":0,"overseaPurchase":2,"canSelectPrices":[],"Id":"1981297429","Name":"汉高施华蔻Theramed 德国进口立式牙膏清新口腔去牙渍防蛀牙超感洁白牙膏防护牙龈 深层清洁","Num":1,"Price":59.0,"PriceShow":"￥28.90","ImgUrl":"jfs/t7300/358/3965412698/71568/e1b1ec30/59fac234Nf8ca377a.jpg!q70.jpg","CheckType":0}},{"itemType":1,"item":{"Tags":[],"Discount":34.0,"IdForOldVersion":1967029116,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[{"Tags":[],"Discount":0.0,"IdForOldVersion":1981323594,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":2,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{},"cid":1667,"stockCode":0,"weight":"重量:0.27kg","maxNum":200,"cardSpecialId":0,"isProvideService":0,"overseaPurchase":2,"canSelectPrices":[],"Id":"1981323594","Name":"欧乐B 圆形刷头防尘盖保护盖 仅适用圆形刷头","Num":1,"Price":0.0,"PriceShow":"￥0.00","ImgUrl":"jfs/t4135/348/2035378461/65363/35691694/58ca673aN8c9f8666.jpg!q70.jpg","CheckType":0},{"Tags":[],"Discount":0.0,"IdForOldVersion":1981327987,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":2,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"白色"},"cid":741,"stockCode":0,"weight":"重量:0.07kg","maxNum":200,"cardSpecialId":0,"isProvideService":0,"overseaPurchase":2,"canSelectPrices":[],"Id":"1981327987","Name":"电动牙刷收纳盒存放盒便携旅行盒 可放1个刷柄2个刷头 白色","Num":1,"Price":0.0,"PriceShow":"￥0.00","ImgUrl":"jfs/t4249/339/2019097090/109088/643a5214/58ca67f1N3b21d391.jpg!q70.jpg","CheckType":0}],"giftsType":0,"specialId":"1","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"颜色:DB4010干电池款/全身水洗"},"cid":741,"stockCode":0,"orderType":"1","maxNum":200,"skuLabels":{"skuHead":[{"u":"tab_031"}]},"cardSpecialId":0,"isProvideService":0,"overseaPurchase":2,"canSelectPrices":[],"Id":"1967029116","Name":"欧乐B（Oral-B） DB4010 电动牙刷 成人自动牙刷 DB4010干电池款/全身水洗","Num":1,"Price":99.0,"PriceShow":"￥65.00","ImgUrl":"jfs/t15550/116/1217578445/256274/ec539513/5a4c4376Na27a8830.jpg!q70.jpg","CheckType":0}}]},{"vendorId":684932,"vendorType":0,"shopId":681185,"shopName":"Beats旗舰店","vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":0.0,"IdForOldVersion":12858430734,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"65536","stockState":"有货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"b":"版本:通用版","a":"颜色:玫瑰金"},"cid":842,"stockCode":0,"maxNum":200,"skuLabels":{"priceTop":[{"u":"tab_var_071","t":"白条6期免息"}]},"cardSpecialId":4,"isProvideService":0,"overseaPurchase":0,"canSelectPrices":[],"Id":"12858430734","Name":"Beats Solo3 Wireless 蓝牙无线头戴式降噪线控苹果B耳机 玫瑰金 通用版","Num":1,"Price":1688.0,"PriceShow":"￥1,688.00","ImgUrl":"jfs/t16210/187/1091985848/225825/920f5670/5a4b202bN1b60212b.jpg!q70.jpg","CheckType":0}}]},{"vendorId":214947,"vendorType":0,"shopId":206157,"shopName":"Quantum海外专营店","vendorPrice":0.0,"specialId":0,"sorted":[{"itemType":1,"item":{"Tags":[],"Discount":150.0,"IdForOldVersion":1988770736,"Point":0,"PriceImg":"","RePrice":0.0,"AwardType":0,"targetId":0,"isBook":false,"isYb":false,"Gifts":[],"specialId":"1","stockState":"无货","remainNum":"","remainNumInt":-1,"canSelectPromotions":[],"propertyTags":{"a":"颜色:玫瑰金"},"cid":842,"stockCode":1,"orderType":"1","maxNum":200,"skuLabels":{"skuHead":[{"u":"tab_031"}]},"cardSpecialId":0,"isProvideService":0,"overseaPurchase":2,"canSelectPrices":[],"Id":"1988770736","Name":"Beats solo3 wireless 蓝牙耳机头戴式 无线耳机/耳麦 玫瑰金","Num":1,"Price":1538.0,"PriceShow":"￥1,388.00","ImgUrl":"jfs/t6004/83/929261435/782552/225a0e1c/592e6c8fNcbe18a74.jpg!q70.jpg","CheckType":0}}]}],"specialId":19,"Num":13,"cartNum":11,"checkedWareNum":0,"limitCartNum":50,"limitWareNum":1000,"limitBookNum":1000,"limitNotBookNum":200,"RePrice":0.0,"Price":0.0,"IsEmpty":false,"PriceShow":"￥0.00","Skus":[],"Suits":[],"Gifts":[],"tip_1":"","tip_2":"","configVersion":"117","abCards":{"3":"A","2":"A","1":"B","7":"B","5":"A","4":"B","9":"B","8":"B","11":"A"},"promotionSwitch":0,"promotionSavePrice":0},"notice":{"value":"","specialId":0},"configCards":{"cardsNotice":[{"cardId":"2","elems":[{"elemType":1,"imgUrl":"https://m.360buyimg.com/mobilecms/jfs/t3109/58/7616258500/454/41016427/58b7d4ecN66d287e8.png"},{"elemType":0,"text":"购物车中有6件商品已享白条分期免息，快去看看"}]}]}}

